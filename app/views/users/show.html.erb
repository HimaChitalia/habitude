<h4><%= @user.name.capitalize %>'s Profile</h4>

<p>
  <strong>Email:</strong>
  <%= @user.email %>
</p>

<p>
  <strong>Role:</strong>
  <%= @user.role %>
</p>

<% if current_user == @user %>
  <%= form_tag(personal_habits_path, :method => "get", id: "search-form") do %>
    <%= select_tag "category_id", options_from_collection_for_select(Category.all, "id", "name"), placeholder: "Search Your Habits for the Category"  %>
    <%= submit_tag "Search", :name => nil %>
  <% end %> <br> <br>
<% end %>

<% if @user.habits.size > 0 %>
  <h4><a href="#" class="js-habit-index" data-id="<%= @user.id %>"><%= @user.name.capitalize %>'s Habits</h4><a/>
  <%= render 'user_habits', habits: @user.habits %>
<% else %>
  <h4>Create a <%= link_to 'habit', new_habit_path %> here!</h4>
<% end %> <br><br>

<% if @user.comments.size > 0 %>
  <h4><%= @user.name.capitalize %>'s Comments:</h4>
  <%= render 'user_comments', comments: @user.comments %>
<% else %>
  <h4>Uncover all of the interesting <%= link_to 'habits', habits_path %> here!</h4>
<% end %> <br><br>

<%= link_to 'Edit', edit_user_path(@user) %> |
<%= link_to 'Back', users_path %>

<script type="text/javascript" charset="utf-8">
$(function () {
  $(".js-habit-index").on("click", function(element) {
    element.preventDefault();
    var userId = parseInt($(".js-habit-index").attr("data-id"));
    $.get("/users/" + userId + "/habits" + ".json", function(data) {
    var habits = $(data)
      habits.each(function( index ) {
        var id = this.id;
        var path = Routes.habit_path(id)
        var hName = "<a href='"+ path + "'>" + "‣ " + "Name: " + this.name + "</a>";
        $(".habitName-" + id).html(hName);
        var des = "Description: " + this.description;
        $(".habitDes-" + id).text(des);
        var c = this.categories;
        var categories = $(c)
        $(".habitCategories").text("Categories: ")
        $(".habitCategory").text("Category: ")
        categories.each(function( index ) {
          var categoryId = this.id;
          var cName = "» " + this.name;
          $(".categoryName-" + categoryId).text(cName);
        });
        var g = this.goals;
        var goals = $(g)
        $(".habitGoals").text("Goals: ")
        $(".habitGoal").text("Goal: ")
        goals.each(function( index ) {
          var goalId = this.id;
          var gName = "» " + this.name;
          $(".goalName-" + goalId).text(gName);

          var header = "<h3> Habits: </h3>";
          $('.js-habit-index').html(header);
        });
      });
    });
  });
});
</script>
